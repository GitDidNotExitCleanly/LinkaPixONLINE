<!DOCTYPE html>
<html>
<body>



<canvas id="myCanvas" width="320" height="294"></canvas>
    <script>
		var canvas = document.getElementById('myCanvas');
		var ctx = canvas.getContext('2d');
		var imageObj = new Image();
		imageObj.src = 'test_colour.jpg';

		imageObj.onload = function() {
			ctx.drawImage(imageObj, 0, 0);
			
			var width = 15; // User specified
			var height = 14; // User specified
			
			var blockWidth = Math.round(canvas.width / width);
			var blockHeight = Math.round(canvas.height / height);
	  
			var pixArray = new Array(height);
			for (var m = 0; m < pixArray.length; m++) {
				pixArray[m] = new Array(width);
			}
			
			for (i = 0; i < height; i++) {
				for (j = 0; j < width; j++) {
					var imgData = ctx.getImageData(j * blockWidth + blockWidth / 2, i * blockHeight + blockHeight / 2, 1, 1);
					/* divide the RGB space into 64 small cubes */
					var rBlock = Math.floor(imgData.data[0] / 64);
					var gBlock = Math.floor(imgData.data[1] / 64);
					var bBlock = Math.floor(imgData.data[2] / 64);
					
					// group each pixel into the corresponding 'cube'
					// use the values 0 ~ 63 to represent which cube the pixel is in
					// Use the value of vertex(centre?) of the cube as the colour of this group of pixels
					switch (rBlock) {
						case 0:
							switch (gBlock) {
								case 0:
									switch (bBlock) {
										case 0: pixArray[i][j] = 63; break; // RGB = [31, 31, 31] (centre of the cube)
										case 1: pixArray[i][j] = 62; break; // [31, 31, 95]
										case 2: pixArray[i][j] = 61; break; // [31, 31, 159]
										case 3: pixArray[i][j] = 60; break; // [31, 31, 223]
									}
									break;
								case 1:
									switch (bBlock) {
										case 0: pixArray[i][j] = 59; break; // [31, 95, 31]
										case 1: pixArray[i][j] = 58; break; // [31, 95, 95]
										case 2: pixArray[i][j] = 57; break; // [31, 95, 159]
										case 3: pixArray[i][j] = 56; break; // [31, 95, 223]
									}
									break;
								case 2:
									switch (bBlock) {
										case 0: pixArray[i][j] = 55; break; // [31, 159, 31]
										case 1: pixArray[i][j] = 54; break; // [31, 159, 95]
										case 2: pixArray[i][j] = 53; break; // [31, 159, 159]
										case 3: pixArray[i][j] = 52; break; // [31, 159, 223]
									}
									break;
								case 3:
									switch (bBlock) {
										case 0: pixArray[i][j] = 51; break; // [31, 223, 31]
										case 1: pixArray[i][j] = 50; break; // [31, 223, 95]
										case 2: pixArray[i][j] = 49; break; // [31, 223, 159]
										case 3: pixArray[i][j] = 48; break; // [31, 223, 223]
									}
									break;
							}
							break;
						case 1:
							switch (gBlock) {
								case 0:
									switch (bBlock) {
										case 0: pixArray[i][j] = 47; break; // [95, 31, 31]
										case 1: pixArray[i][j] = 46; break; // [95, 31, 95]
										case 2: pixArray[i][j] = 45; break; // [95, 31, 159]
										case 3: pixArray[i][j] = 44; break; // [95, 31, 223]
									}
									break;
								case 1:
									switch (bBlock) {
										case 0: pixArray[i][j] = 43; break; // [95, 95, 31]
										case 1: pixArray[i][j] = 42; break; // [95, 95, 95]
										case 2: pixArray[i][j] = 41; break; // [95, 95, 159]
										case 3: pixArray[i][j] = 40; break; // [95, 95, 223]
									}
									break;
								case 2:
									switch (bBlock) {
										case 0: pixArray[i][j] = 39; break; // [95, 159, 31]
										case 1: pixArray[i][j] = 38; break; // [95, 159, 95]
										case 2: pixArray[i][j] = 37; break; // [95, 159, 159]
										case 3: pixArray[i][j] = 36; break; // [95, 159, 223]
									}
									break;
								case 3:
									switch (bBlock) {
										case 0: pixArray[i][j] = 35; break; // [95, 223, 31]
										case 1: pixArray[i][j] = 34; break; // [95, 223, 95]
										case 2: pixArray[i][j] = 33; break; // [95, 223, 159]
										case 3: pixArray[i][j] = 32; break; // [95, 223, 223]
									}
									break;
							}
							break;
						case 2:
							switch (gBlock) {
								case 0:
									switch (bBlock) {
										case 0: pixArray[i][j] = 31; break; // [159, 31, 31]
										case 1: pixArray[i][j] = 30; break; // [159, 31, 95]
										case 2: pixArray[i][j] = 29; break; // [159, 31, 159]
										case 3: pixArray[i][j] = 28; break; // [159, 31, 223]
									}
									break;
								case 1:
									switch (bBlock) {
										case 0: pixArray[i][j] = 27; break; // [159, 95, 31]
										case 1: pixArray[i][j] = 26; break; // [159, 95, 95]
										case 2: pixArray[i][j] = 25; break; // [159, 95, 159]
										case 3: pixArray[i][j] = 24; break; // [159, 95, 223]
									}
									break;
								case 2:
									switch (bBlock) {
										case 0: pixArray[i][j] = 23; break; // [159, 159, 31]
										case 1: pixArray[i][j] = 22; break; // [159, 159, 95]
										case 2: pixArray[i][j] = 21; break; // [159, 159, 159]
										case 3: pixArray[i][j] = 20; break; // [159, 159, 223]
									}
									break;
								case 3:
									switch (bBlock) {
										case 0: pixArray[i][j] = 19; break; // [159, 223, 31]
										case 1: pixArray[i][j] = 18; break; // [159, 223, 95]
										case 2: pixArray[i][j] = 17; break; // [159, 223, 159]
										case 3: pixArray[i][j] = 16; break; // [159, 223, 223]
									}
									break;
							}
							break;
						case 3:
							switch (gBlock) {
								case 0:
									switch (bBlock) {
										case 0: pixArray[i][j] = 15; break; // [223, 31, 31] 
										case 1: pixArray[i][j] = 14; break; // [223, 31, 95]
										case 2: pixArray[i][j] = 13; break; // [223, 31, 159]
										case 3: pixArray[i][j] = 12; break; // [223, 31, 223]
									}
									break;
								case 1:
									switch (bBlock) {
										case 0: pixArray[i][j] = 11; break; // [223, 95, 31]
										case 1: pixArray[i][j] = 10; break; // [223, 95, 95]
										case 2: pixArray[i][j] = 9; break; // [223, 95, 159]
										case 3: pixArray[i][j] = 8; break; // [223, 95, 223]
									}
									break;
								case 2:
									switch (bBlock) {
										case 0: pixArray[i][j] = 7; break; // [223, 159, 31]
										case 1:	pixArray[i][j] = 6; break; // [223, 159, 95]
										case 2:	pixArray[i][j] = 5; break; // [223, 159, 159]
										case 3: pixArray[i][j] = 4; break; // [223, 159, 223]
									}
									break;
								case 3:
									switch (bBlock) {
										case 0: pixArray[i][j] = 3; break; // [223, 223, 31]
										case 1:	pixArray[i][j] = 2; break; // [223, 223, 95]
										case 2:	pixArray[i][j] = 1; break; // [223, 223, 159]
										case 3:	pixArray[i][j] = 0; break; // [223, 223, 223]
									}
									break;
							}
							break;
					}
				}
			}
			
			for (var a  = 0; a < pixArray.length; a ++) {
				console.log(pixArray[a]);
			}
		};
		
		

		
		
		
	</script>
</body>
</html>